#  Refactored Oberon-0 Compiler

This directory contains a *refactored* version of the "faithful" translation into Swift of Niklaus Writh's Oberon-0 compiler from his *Compiler Construction* book.  The faithful translation was intended to be as much as possible a line-for-line literal translation of the original compliler source code from Oberon into Swift, allowing one to easily match up the original with a working, compilable version in Swift.  The commitment to being a faithful reproduction of the original has some consequences: It preserves most of the faults in the original that make it hard to follow (though at least the formatting is improved), including all the poor identifier names, reliance on unfamiliar Oberon types, extensive reliance on global variables, tight coupling of logically separate entities, and overall it is pretty alien to what any Swift programmer would actually want to write, all of which severly undermine its value in teaching anyone how to actually implement a compiler.

This version aims to fix those problems through refactoring.  It uses native Swift types, removing all dependencies on simulated Oberon types.  It also removed dependencies on the simulated Texts module,  using types from the Swift standard library as well as Foundation.  Identifiers are renamed to be more meaningful (though that is a work in progress): for example OSS became Lexer, OSP became Parser, OSG became RISCCodeGenerator, and RISC became RISCEmulator.   In addition, those major components were changed from being a collection of static functions that work on global data, to being properly instantiable types, so now for example, one could actually compile multiple Oberon-0 source files in parallel, each in their own instance of the parser.  Many nested functions were extracted to make the functions in which they were previously declared more readable by eliminating the large gap between the function signature and its implementation.  This extraction also required eliminating dependencies on captured local variables from the outer function, which in turn makes the extracted functions themselves clearer.  Portions of long functions are also extracted into their own independent functions, allowing one to focus a bit more on conceptual working of the function without getting quite so mired down into its implementation details.  I've also refactored some integer constants as Swift enums, which helps with type checking, and I think makes the code more readable.

You'll notice that this version contains many more source files than the "faithful" version, but's not actually much more code.  This is largely just the result of pulling data structures that were embedded in other source files into their own. 

While most of the changes were baby-step refactorings, the symbol table system was completely overhauled.   I've written a separate document explaining its working.  The original code mixed symbol table implementation details intimately in parsing code, making it hard to follow.   I think you'll find this new symbol table system allows following the parser logic much easier, and greatly simplifies the actual symbol table mechanism itself.

The `Common` directory primarily contains the code refactored from Wirth's original source code, with the exception of `UTF8CharacterReader` which is used in the Lexer and  replaces `Texts.Reader`.

The `StandardTypeExtensions` directory contains, as its name suggests, useful extensions to standard types form both the  Swift standard library and from Foundation, though it also contains some subclassed objects and specific instances of Swift protocols, like `FileHandleOutputStream`, which impements Swift's `TextOutputStream` protocol for use with `FileHandle` (for example, to specify writing to `FileHandle.standardOutput` or `FileHandle.standardError`), and `FileInputStream`, a subclass of Foundation's `InputStream` that  specifically implements a `FileHandle` based input.

Although I am working in Xcode on macOS, I have purposefully avoided using anything from Cocoa, Cocoa Touch, or Swift UI, as these are specific to the Apple ecosystem, while at least in principle the Swift standard library and Foundation have been opened sourced by Apple, and theoretically available on any platform to which Swift has been ported.

Despite the freedom I've allowed myself in this version to make extensive changes to the code for the sake of clarity and design, I have chosen to leave it's fundamental operation intact.  Therefore this version does not extend the Oberon-0 language, or the RISC emulator.  The compiler still translates the Oberon-0 source code into RISC machine code in one pass, which is to say, I have not added some additional phases that are common in modern compilers, such as the creation of an abstract syntax tree, separate type checking or semantic analysis phases, nor does it introduce an intermediate language.
